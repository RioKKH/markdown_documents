# Git操作

## コミット取り消し方法

コミットを取り消す方法はいくつかあり、状況によって適切な方法が異なる。主なシナリオ毎に以下に説明する。

### 1. 直前のコミットを取り消す

以下の作業は、リモートには未だpushしていない前提となる。

#### a. コミットを完全に削除する（変更も削除）

```bash
# 直前のコミットを完全に削除する（変更も失われる）
git reset --hard HEAD~1
```

#### b. コミットを取り消すが、変更はステージングに残す

```bash
git reset --soft HEAD~1
```

#### c. コミットを取り消すが、変更を作業ディレクトリに残す

```bash
git reset HEAD~1
# または
git reset --mixed HEAD~1
```

#### d. コミットを打ち消す新しいコミットを作成する（revert）

```bash
# 直前のコミットを打ち消す新しいコミットを作成する
git revert HEAD
```

### 2. 特定のコミットを取り消す

#### a. 特定のコミットを完全に削除する（それ以降のコミットも変更される）

```bash
git reset --hard <コミットID>
```

#### b. 特定のコミットのみを打ち消す（revert）

```bash
# 特定のコミットのみを打ち消す新しいコミットを作成する
git revert <コミットID>
```

#### c. 特定のコミットを編集する（対話的リベース）

```bash
# 対象コミットの前からリベース開始
git rebase -i <コミットID>^

# エディタで対象コミットの行を「edit」に変更
# 変更後、以下を実行
git commit --amend
git rebase --continue
```

### 3. 複数のコミットを取り消す

#### a. 連続した複数コミットを取り消す

```bash
# 3つ前のコミットまで戻る（3つのコミットを取り消す）
git reset --hard HEAD~3
```

#### b. 連続した複数コミットを打ち消す（revert-range）

```bash
# コミット範囲を指定して一括でrevert
git revert <開始コミットID>^..<終了コミットID>
```

#### c. 複数の特定コミットを個別に打ち消す

```bash
# 複数のコミットを個別にrevert
git revert <コミットID1> <コミットID2> <コミットID3>
```

### 4. プッシュ済みコミットの取り消し

#### a. ローカルで取り消し、強制プッシュ

```bash
# コミットを取り消す
git reset --hard HEAD~1
# 強制プッシュ（共有して作業している人に影響する為注意が必要！）
git push --force origin <ブランチ名>
```

#### b. 打消しコミットを作成してプッシュ（推奨）

```bash
# 取り消しコミットを作成。つまりrevertした履歴が残る
git revert HEAD
# 通常通りプッシュする
git push origin <ブランチ名>
```

### 5. マージコミットの取り消し

#### a. マージコミットを取り消し（revert）

```bash
# マージコミットをrevert（-m オプションで親を指定）
git revert -m 1 <マージコミットID>
```

#### b. マージコミットを削除（reset）

```bash
# マージコミットを削除
git reset --hard <マージコミット前のID>
```

### 6. コミットメッセージだけを修正

```bash
# 直前のコミットメッセージを修正
git commit --amend -m "新しいコミットメッセージ"

# または対話的に修正する
git commit --amend
```

